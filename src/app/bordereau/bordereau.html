<div class="container my-2 printable-area" *ngIf="operation_en_cours">
    
    <div class="header-section border-bottom pb-2 mb-3">
        <div class="row align-items-center">
            <div class="col-3">
                <div class="bg-danger text-white p-2 rounded text-center">
                    <h6 class="mb-0 fw-bold">LA POSTE</h6>
                    <small style="font-size: 0.6rem;">TUNISIENNE</small>
                </div>
            </div>
            <div class="col-6 text-center">
                <h4 class="fw-bold text-uppercase mb-0" style="color: #0056b3;">BORDEREAU D'EXPÉDITION</h4>
                <p class="small text-muted mb-0">Service Courrier - Colis - Express</p>
            </div>
            <div class="col-3 text-end">
                <i class="bi bi-qr-code fs-2"></i>
            </div>
        </div>
    </div>

    <div class="row g-2 mb-3" style="font-size: 0.8rem;">
        <div class="col-6">
            <div class="p-2 border rounded bg-light">
                <strong>Référence :</strong> {{ operation_en_cours.formattedId }} [cite: 7, 33]<br>
                <strong>Date :</strong> {{ operation_en_cours.createdAt | date:'dd/MM/yyyy' }} [cite: 7]<br>
                <strong>Heure :</strong> {{ operation_en_cours.createdAt | date:'HH:mm' }} [cite: 7]
            </div>
        </div>
        <div class="col-6">
            <div class="p-2 border rounded bg-light">
                <strong>Agence :</strong> DIRECT POST [cite: 8]<br>
                <strong>Service :</strong> Express Premium [cite: 9]<br>
                <strong>Tél :</strong> 70 100 100 [cite: 11, 31]
            </div>
        </div>
    </div>

    <div class="parcels-section mb-3">
        <div class="bg-primary text-white px-2 py-1 rounded-top">
            <h6 class="mb-0" style="font-size: 0.9rem;">LISTE DES COLIS ({{ operation_en_cours.parcel?.length }})</h6>
        </div>
        <table class="table table-sm table-bordered mb-0" style="font-size: 0.75rem;">
            <thead class="table-dark">
                <tr> 
                    <th width="5%" class="text-center">N°</th>
                    <th width="20%">Numéro Suivi</th>
                    <th width="35%">Destinataire / Raison Sociale</th>
                    <th width="15%" class="text-center">Poids (kg)</th>
                    <th width="15%" class="text-end">Montant (TND)</th>
                    <th width="10%" class="text-center">Qté</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let p of operation_en_cours.parcel; let i = index">
                    <td class="text-center">{{ i + 1 }}</td>
                    <td class="fw-bold">{{ p.trackingNumber?.formattedParcelId }}</td>
                    <td>{{ p.receiver.recName }}<br><small class="text-muted">{{ p.receiver.recSocialReason }}</small></td>
                    <td class="text-center">{{ p.weight }}</td>
                    <td class="text-end fw-bold">{{ p.price | number:'1.3-3' }}</td>
                    <td class="text-center">1</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="envelopes-section mb-3" *ngIf="operation_en_cours.pochette?.length > 0">
        <div class="bg-secondary text-white px-2 py-1 rounded-top">
            <h6 class="mb-0" style="font-size: 0.9rem;">LISTE DES POCHETTES</h6>
        </div>
        <table class="table table-sm table-bordered mb-0" style="font-size: 0.75rem;">
            <thead class="table-secondary">
                <tr>
                    <th width="5%" class="text-center">N°</th>
                    <th width="15%" class="text-center">Quantité</th>
                    <th width="50%">Désignation du Type</th>
                    <th width="15%" class="text-center">Prix Unitaire</th>
                    <th width="15%" class="text-end">Total (TND)</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let po of operation_en_cours.pochette; let i = index">
                    <td class="text-center">{{ i + 1 }}</td>
                    <td class="text-center">{{ po.quantite }}</td>
                    <td>{{ po.typePochette }}</td>
                    <td class="text-center">{{ (po.totalPrice / po.quantite) | number:'1.3-3' }}</td>
                    <td class="text-end fw-bold">{{ po.totalPrice | number:'1.3-3' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="row g-2 align-items-stretch">
        <div class="col-8">
            <div class="signature-area p-2 border rounded h-100" style="font-size: 0.7rem;">
                <p class="mb-2 text-center border-bottom pb-1"><strong>REMARQUES :</strong> Les colis sont soumis aux conditions de La Poste [cite: 21, 22]</p>
                <div class="row text-center mt-2">
                    <div class="col-6 border-end">
                        <strong>Agent La Poste</strong> [cite: 23]
                        <p class="mt-3 mb-0 small text-muted">(Cachet et Signature)</p>
                    </div>
                    <div class="col-6">
                        <strong>Signature du Client</strong> [cite: 34]
                        <p class="mt-3 mb-0 small text-muted">(Accord et réception)</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="total-section bg-light border p-2 rounded text-center h-100">
                <small class="text-uppercase fw-bold text-muted">Montant Total</small> [cite: 24]
                <h3 class="fw-bold text-primary mb-0">{{ total | number:'1.3-3' }}</h3> [cite: 25]
                <small class="d-block mb-1">Dinars Tunisiens</small> [cite: 26]
                <div class="badge bg-success">PAYÉ</div> [cite: 27]
            </div>
        </div>
    </div>

    <div class="poste-footer border-top mt-3 pt-2 text-center" style="font-size: 0.65rem;">
        <div class="row">
            <div class="col-4"><strong>La Poste Tunisienne</strong><br>www.poste.tn [cite: 28, 29]</div>
            <div class="col-4"><strong>Service Client</strong><br>70 100 100 [cite: 30, 31]</div>
            <div class="col-4"><strong>Document Officiel</strong><br>N° {{ operation_en_cours.formattedId }} [cite: 32, 33]</div>
        </div>
    </div>
</div>