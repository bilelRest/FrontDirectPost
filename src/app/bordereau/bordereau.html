<div class="container my-4 printable-area" *ngIf="operation_en_cours">
    
    <!-- En-tête avec logo La Poste Tunisienne -->
    <div class="header-section border-bottom pb-4 mb-4">
        <div class="row align-items-center">
            <div class="col-3">
                <div class="poste-logo text-center">
                    <div class="logo-container bg-danger text-white p-3 rounded d-inline-block">
                        <h4 class="mb-0 fw-bold">LA POSTE</h4>
                        <p class="mb-0 small">TUNISIENNE</p>
                    </div>
                </div>
            </div>
            <div class="col-6 text-center">
                <h1 class="fw-bold text-uppercase mb-2" style="color: #0056b3;">BORDEREAU D'EXPÉDITION</h1>
                <p class="text-muted mb-1">Service Courrier - Colis - Express</p>
                <p class="small text-muted">République Tunisienne - Ministère des Technologies</p>
            </div>
            <div class="col-3 text-end">
                <div class="qr-code-placeholder border p-2 d-inline-block">
                    <small class="text-muted">Code QR</small>
                    <div class="bg-light text-center p-1 mt-1">
                        <i class="bi bi-qr-code fs-4"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section informations principales -->
    <div class="main-info-section mb-4">
        <div class="row">
            <div class="col-md-6">
                <div class="info-card p-3 border rounded mb-3">
                    <h6 class="fw-bold border-bottom pb-2 mb-3">INFORMATIONS CLIENT</h6>
                    <div class="row">
                        <div class="col-6">
                            <p class="mb-1"><strong>Référence :</strong></p>
                            <p class="mb-1"><strong>Date :</strong></p>
                            <p class="mb-1"><strong>Heure :</strong></p>
                        </div>
                        <div class="col-6">
                            <p class="mb-1 fw-bold text-primary">{{ operation_en_cours.formattedId }}</p>
                            <p class="mb-1">{{ operation_en_cours.createdAt | date:'dd/MM/yyyy' }}</p>
                            <p class="mb-1">{{ operation_en_cours.createdAt | date:'HH:mm' }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="info-card p-3 border rounded mb-3">
                    <h6 class="fw-bold border-bottom pb-2 mb-3">AGENCE DIRECT POST</h6>
                    <p class="mb-1"><strong>Service :</strong> Express Premium</p>
                    <p class="mb-1"><strong>Code Agence :</strong> DP{{ operation_en_cours.formattedId?.slice(0,4) || '0000' }}</p>
                    <p class="mb-1"><strong>Tél :</strong> 70 100 100</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Section des colis -->
    <div  class="parcels-section mb-5">
        <div class="section-header bg-primary text-white p-2 rounded-top">
            <h5 class="mb-0"><i class="bi bi-box-seam me-2"></i>LISTE DES COLIS ({{ parcels.length }})</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered align-middle mb-0">
                <thead class="table-dark">
                    <tr> 
                        <th width="5%" class="text-center">N°</th>
                        <th width="15%">Numéro Suivi</th>
                        <th width="25%">Destinataire</th>
                        <th width="20%">Raison Sociale</th>
                        <th width="10%" class="text-center">Poids (kg)</th>
                        <th width="15%" class="text-end">Montant (TND)</th>
                        <th width="10%" class="text-center">Qté</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let p of operation_en_cours.parcel; let i = index">
                        <td class="text-center fw-bold">{{ i + 1 }}</td>
                        <td class="fw-bold text-primary">
                            <span class="tracking-number">{{ p.trackingNumber?.formattedParcelId || '--' }}</span>
                        </td>
                        <td>
                            <div class="fw-medium">{{ p.receiver.recName }}</div>
                            <small class="text-muted">Livraison Express</small>
                        </td>
                        <td>{{ p.receiver.recSocialReason || 'Particulier' }}</td>
                        <td class="text-center">{{ p.weight }}</td>
                        <td class="text-end fw-bold">{{ p.price | number:'1.3-3' }}</td>
                        <td class="text-center">1</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Section des pochettes -->
    <div class="envelopes-section mb-5">
        <div class="section-header bg-secondary text-white p-2 rounded-top">
            <h5 class="mb-0"><i class="bi bi-envelope me-2"></i>LISTE DES POCHETTES</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered align-middle mb-0">
                <thead class="table-secondary">
                    <tr>
                        <th width="5%" class="text-center">N°</th>
                        <th width="15%" class="text-center">Quantité</th>
                        <th width="50%">Désignation du Type</th>
                        <th width="15%" class="text-center">Prix Unitaire</th>
                        <th width="15%" class="text-end">Total (TND)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let p of operation_en_cours.pochette; let i = index">
                        <td class="text-center fw-bold">{{ i + 1 }}</td>
                        <td class="text-center">{{ p.quantite }}</td>
                        <td>{{ p.typePochette }}</td>
                        <td class="text-center">{{ (p.totalPrice || 0) | number:'1.3-3' }}</td>
                        <td class="text-end fw-bold">{{ (p.totalPrice || 0) | number:'1.3-3' }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Section total et signature -->
    <div class="footer-section mt-5">
        <div class="row">
            <div class="col-md-8">
                <div class="signature-area p-4 border rounded">
                    <p class="mb-4 text-center"><strong>REMARQUES :</strong> Les colis sont soumis aux conditions générales de transport de La Poste Tunisienne</p>
                    <div class="row">
                        <div class="col-6">
                            <div class="border-top pt-3 text-center">
                                <p class="mb-0"><strong>Cachet et Signature</strong></p>
                                <p class="small text-muted">Agent La Poste</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border-top pt-3 text-center">
                                <p class="mb-0"><strong>Signature du Client</strong></p>
                                <p class="small text-muted">Pour accord et réception</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="total-section bg-light p-4 border rounded">
                    <div class="text-center mb-3">
                        <h6 class="text-uppercase text-muted">Montant Total</h6>
                        <div class="total-amount">
                            <h1 class="fw-bold text-primary mb-0">{{total | number:'1.3-3'}}</h1>
                            <h4 class="text-muted">Dinars Tunisiens</h4>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="stamp-placeholder border border-danger d-inline-block p-2">
                            <small class="text-danger fw-bold">PAYÉ</small>
                            <div class="text-center mt-1">
                                <i class="bi bi-check-circle-fill text-success fs-4"></i>
                            </div>
                        </div>
                    </div>
                    <p class="text-center small mt-3">
                        <i class="bi bi-info-circle me-1"></i>
                        Taux TVA 19% inclus
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pied de page -->
    <div class="poste-footer border-top mt-4 pt-3">
        <div class="row text-center">
            <div class="col-md-4 mb-2">
                <p class="small mb-0"><strong>La Poste Tunisienne</strong></p>
                <p class="small text-muted mb-0">www.poste.tn</p>
            </div>
            <div class="col-md-4 mb-2">
                <p class="small mb-0"><strong>Service Client</strong></p>
                <p class="small text-muted mb-0">70 100 100</p>
            </div>
            <div class="col-md-4 mb-2">
                <p class="small mb-0"><strong>Document Officiel</strong></p>
                <p class="small text-muted mb-0">N° {{ operation_en_cours.formattedId }}</p>
            </div>
        </div>
    </div>

</div>


